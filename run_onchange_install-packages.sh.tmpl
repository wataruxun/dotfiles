#!/bin/sh
# vim: ft=sh

# -e: exit on error
# -u: exit on unset variables
set -eu

# このスクリプトは chezmoi によって自動的に実行され、
# 各OSに必要なパッケージをインストールします。

install_packages() {
  # --- macOS (Homebrew) ---
  {{ if eq .chezmoi.os "darwin" -}}
  echo "> Updating Homebrew..."
  brew update

  echo "> Installing packages with Homebrew..."
  # パッケージ一覧と用途:
  #   zsh                                 [.zshrc] シェル本体
  #   tmux                                [.tmux.conf] ターミナルマルチプレクサ
  #   neovim                              [.vimrc / .config/nvim/] テキストエディタ
  #   git                                 [全般] バージョン管理
  #   zsh-syntax-highlighting             [.zshrc] シンタックスハイライト
  #   zsh-autosuggestions                 [.zshrc] 補完候補表示
  #   powerlevel10k                       [.zshrc] zshテーマ
  #   ripgrep                             [汎用] 高速grep
  #   fd                                  [汎用] 高速find
  #   lazygit                             [汎用] git TUIクライアント
  #   gdu                                 [汎用] ディスク使用量確認
  #   bottom                              [汎用] システムモニター
  #   unzip                               [汎用] 解凍ツール
  brew install zsh tmux neovim git \
    zsh-syntax-highlighting zsh-autosuggestions powerlevel10k \
    ripgrep fd lazygit gdu bottom unzip

  # --- Arch Linux (pacman) ---
  {{ else if eq .chezmoi.os "linux" -}}
  echo "> Updating pacman repositories..."
  sudo pacman -Syu --noconfirm

  echo "> Installing packages with pacman..."
  # パッケージ一覧と用途は macOS セクションのコメントを参照
  # gcc のみ Linux 追加: コンパイラ（neovimプラグインのビルド等に必要）
  sudo pacman -S --noconfirm --needed \
    zsh tmux neovim git \
    zsh-syntax-highlighting zsh-autosuggestions powerlevel10k \
    ripgrep fd lazygit gdu bottom unzip gcc

  {{ end -}}

  echo "> Package installation script finished."
}

install_packages
